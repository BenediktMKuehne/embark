name: EMBArk Python tests

on:
  pull_request:
    branches:
      - main

jobs:
  default-install:
    # if: github.repository_owner == 'e-m-b-a'
    runs-on: ubuntu-22.04

    steps:
      - name: Checkout Code
        uses: actions/checkout@v3
      # - name: Free Disk Space (Ubuntu)
      #   uses: jlumbroso/free-disk-space@main
      #   with:
      #     tool-cache: true
      #     android: true
      #     dotnet: true
      #     haskell: true
      #     large-packages: false
      #     swap-storage: true
      - name: EMBArk default install
        uses: Wandalen/wretry.action@master
        with:
          command: sudo ./installer.sh -sF
          attempt_limit: 3
      - name: tests
        uses: Wandalen/wretry.action@master
        with:
          command: pipenv run python manage.py test
          attempt_limit: 3
